<?xml version="1.0" standalone="yes"?>
<semantic:definitions id="definitions_InvoiceApproval"
    targetNamespace="http://example.com/bpmn/invoice-approval"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:semantic="http://www.omg.org/spec/BPMN/20100524/MODEL"
    xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
    xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI">

  <semantic:collaboration id="collab_InvoiceApproval">
    <semantic:participant id="participant_InvoiceProcessor" name="Invoice Processor" processRef="process_MainInvoice"/>
    <semantic:participant id="participant_FirstApprover" name="First Approver" processRef="process_FirstApproval"/>
    <semantic:participant id="participant_SecondApprover" name="Second Approver" processRef="process_SecondApproval"/>

    <semantic:messageFlow id="mf_ip_to_fa_request" name="1st Stage Request" sourceRef="ip_send_1st_approval" targetRef="fa_start_message"/>
    <semantic:messageFlow id="mf_fa_to_ip_decision" name="1st Stage Decision" sourceRef="fa_end_message" targetRef="ip_receive_1st_decision"/>
    <semantic:messageFlow id="mf_ip_to_sa_request" name="2nd Stage Request" sourceRef="ip_send_2nd_approval" targetRef="sa_start_message"/>
    <semantic:messageFlow id="mf_sa_to_ip_decision" name="2nd Stage Decision" sourceRef="sa_end_message" targetRef="ip_receive_2nd_decision"/>
  </semantic:collaboration>

  <semantic:process id="process_MainInvoice" isExecutable="true">
    <semantic:laneSet id="laneset_MainInvoice">
      <semantic:lane id="lane_InvoiceProcessor" name="Invoice Processor Lane">
        <semantic:flowNodeRef>ip_start_event</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_send_1st_approval</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_receive_1st_decision</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_gateway_1st_decision</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_end_event_1st_rejection</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_send_2nd_approval</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_receive_2nd_decision</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_gateway_2nd_decision</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_end_event_2nd_rejection</semantic:flowNodeRef>
        <semantic:flowNodeRef>ip_end_event_approved</semantic:flowNodeRef>
      </semantic:lane>
    </semantic:laneSet>

    <semantic:startEvent id="ip_start_event" name="Invoice Received for Processing">
      <semantic:outgoing>flow_ip_1</semantic:outgoing>
    </semantic:startEvent>
    <semantic:sendTask id="ip_send_1st_approval" name="Send Invoice for 1st Stage Approval" messageRef="msg_1st_request">
      <semantic:incoming>flow_ip_1</semantic:incoming>
      <semantic:outgoing>flow_ip_2</semantic:outgoing>
    </semantic:sendTask>
    <semantic:receiveTask id="ip_receive_1st_decision" name="Receive 1st Stage Approval Decision" messageRef="msg_1st_decision">
      <semantic:incoming>flow_ip_2</semantic:incoming>
      <semantic:outgoing>flow_ip_3</semantic:outgoing>
    </semantic:receiveTask>
    <semantic:exclusiveGateway id="ip_gateway_1st_decision" name="1st Stage Approval Outcome?">
      <semantic:incoming>flow_ip_3</semantic:incoming>
      <semantic:outgoing>flow_ip_4_rejected</semantic:outgoing>
      <semantic:outgoing>flow_ip_5_approved</semantic:outgoing>
    </semantic:exclusiveGateway>
    <semantic:endEvent id="ip_end_event_1st_rejection" name="Process Ended: 1st Stage Rejection">
      <semantic:incoming>flow_ip_4_rejected</semantic:incoming>
    </semantic:endEvent>
    <semantic:sendTask id="ip_send_2nd_approval" name="Send Invoice for 2nd Stage Approval" messageRef="msg_2nd_request">
      <semantic:incoming>flow_ip_5_approved</semantic:incoming>
      <semantic:outgoing>flow_ip_6</semantic:outgoing>
    </semantic:sendTask>
    <semantic:receiveTask id="ip_receive_2nd_decision" name="Receive 2nd Stage Approval Decision" messageRef="msg_2nd_decision">
      <semantic:incoming>flow_ip_6</semantic:incoming>
      <semantic:outgoing>flow_ip_7</semantic:outgoing>
    </semantic:receiveTask>
    <semantic:exclusiveGateway id="ip_gateway_2nd_decision" name="2nd Stage Approval Outcome?">
      <semantic:incoming>flow_ip_7</semantic:incoming>
      <semantic:outgoing>flow_ip_8_rejected</semantic:outgoing>
      <semantic:outgoing>flow_ip_9_approved</semantic:outgoing>
    </semantic:exclusiveGateway>
    <semantic:endEvent id="ip_end_event_2nd_rejection" name="Process Ended: 2nd Stage Rejection">
      <semantic:incoming>flow_ip_8_rejected</semantic:incoming>
    </semantic:endEvent>
    <semantic:endEvent id="ip_end_event_approved" name="Process Ended: Signatures/Approval Obtained">
      <semantic:incoming>flow_ip_9_approved</semantic:incoming>
    </semantic:endEvent>

    <semantic:sequenceFlow id="flow_ip_1" sourceRef="ip_start_event" targetRef="ip_send_1st_approval"/>
    <semantic:sequenceFlow id="flow_ip_2" sourceRef="ip_send_1st_approval" targetRef="ip_receive_1st_decision"/>
    <semantic:sequenceFlow id="flow_ip_3" sourceRef="ip_receive_1st_decision" targetRef="ip_gateway_1st_decision"/>
    <semantic:sequenceFlow id="flow_ip_4_rejected" name="Rejected" sourceRef="ip_gateway_1st_decision" targetRef="ip_end_event_1st_rejection"/>
    <semantic:sequenceFlow id="flow_ip_5_approved" name="Approved" sourceRef="ip_gateway_1st_decision" targetRef="ip_send_2nd_approval"/>
    <semantic:sequenceFlow id="flow_ip_6" sourceRef="ip_send_2nd_approval" targetRef="ip_receive_2nd_decision"/>
    <semantic:sequenceFlow id="flow_ip_7" sourceRef="ip_receive_2nd_decision" targetRef="ip_gateway_2nd_decision"/>
    <semantic:sequenceFlow id="flow_ip_8_rejected" name="Rejected" sourceRef="ip_gateway_2nd_decision" targetRef="ip_end_event_2nd_rejection"/>
    <semantic:sequenceFlow id="flow_ip_9_approved" name="Approved" sourceRef="ip_gateway_2nd_decision" targetRef="ip_end_event_approved"/>
  </semantic:process>

  <semantic:process id="process_FirstApproval" isExecutable="true">
    <semantic:laneSet id="laneset_FirstApproval">
      <semantic:lane id="lane_FirstApprover" name="First Approver Lane">
        <semantic:flowNodeRef>fa_start_message</semantic:flowNodeRef>
        <semantic:flowNodeRef>fa_task_evaluate</semantic:flowNodeRef>
        <semantic:flowNodeRef>fa_task_document_submit</semantic:flowNodeRef>
        <semantic:flowNodeRef>fa_end_message</semantic:flowNodeRef>
      </semantic:lane>
    </semantic:laneSet>
    <semantic:startEvent id="fa_start_message" name="1st Stage Approval Request Arrived">
      <semantic:outgoing>flow_fa_1</semantic:outgoing>
      <semantic:messageEventDefinition messageRef="msg_1st_request"/>
    </semantic:startEvent>
    <semantic:task id="fa_task_evaluate" name="Evaluate 1st Stage Approval Request">
      <semantic:incoming>flow_fa_1</semantic:incoming>
      <semantic:outgoing>flow_fa_2</semantic:outgoing>
    </semantic:task>
    <semantic:task id="fa_task_document_submit" name="Document and Submit 1st Stage Decision">
      <semantic:incoming>flow_fa_2</semantic:incoming>
      <semantic:outgoing>flow_fa_3</semantic:outgoing>
    </semantic:task>
    <semantic:endEvent id="fa_end_message" name="1st Stage Decision Sent">
      <semantic:incoming>flow_fa_3</semantic:incoming>
      <semantic:messageEventDefinition messageRef="msg_1st_decision"/>
    </semantic:endEvent>
    <semantic:sequenceFlow id="flow_fa_1" sourceRef="fa_start_message" targetRef="fa_task_evaluate"/>
    <semantic:sequenceFlow id="flow_fa_2" sourceRef="fa_task_evaluate" targetRef="fa_task_document_submit"/>
    <semantic:sequenceFlow id="flow_fa_3" sourceRef="fa_task_document_submit" targetRef="fa_end_message"/>
  </semantic:process>

  <semantic:process id="process_SecondApproval" isExecutable="true">
    <semantic:laneSet id="laneset_SecondApproval">
      <semantic:lane id="lane_SecondApprover" name="Second Approver Lane">
        <semantic:flowNodeRef>sa_start_message</semantic:flowNodeRef>
        <semantic:flowNodeRef>sa_task_evaluate</semantic:flowNodeRef>
        <semantic:flowNodeRef>sa_task_document_submit</semantic:flowNodeRef>
        <semantic:flowNodeRef>sa_end_message</semantic:flowNodeRef>
      </semantic:lane>
    </semantic:laneSet>
    <semantic:startEvent id="sa_start_message" name="2nd Stage Approval Request Arrived">
      <semantic:outgoing>flow_sa_1</semantic:outgoing>
      <semantic:messageEventDefinition messageRef="msg_2nd_request"/>
    </semantic:startEvent>
    <semantic:task id="sa_task_evaluate" name="Evaluate 2nd Stage Approval Request">
      <semantic:incoming>flow_sa_1</semantic:incoming>
      <semantic:outgoing>flow_sa_2</semantic:outgoing>
    </semantic:task>
    <semantic:task id="sa_task_document_submit" name="Document and Submit 2nd Stage Decision">
      <semantic:incoming>flow_sa_2</semantic:incoming>
      <semantic:outgoing>flow_sa_3</semantic:outgoing>
    </semantic:task>
    <semantic:endEvent id="sa_end_message" name="2nd Stage Decision Sent">
      <semantic:incoming>flow_sa_3</semantic:incoming>
      <semantic:messageEventDefinition messageRef="msg_2nd_decision"/>
    </semantic:endEvent>
    <semantic:sequenceFlow id="flow_sa_1" sourceRef="sa_start_message" targetRef="sa_task_evaluate"/>
    <semantic:sequenceFlow id="flow_sa_2" sourceRef="sa_task_evaluate" targetRef="sa_task_document_submit"/>
    <semantic:sequenceFlow id="flow_sa_3" sourceRef="sa_task_document_submit" targetRef="sa_end_message"/>
  </semantic:process>

  <semantic:message id="msg_1st_request" name="1st Stage Approval Request"/>
  <semantic:message id="msg_1st_decision" name="1st Stage Approval Decision"/>
  <semantic:message id="msg_2nd_request" name="2nd Stage Approval Request"/>
  <semantic:message id="msg_2nd_decision" name="2nd Stage Approval Decision"/>

  <bpmndi:BPMNDiagram id="BPMNDiagram_InvoiceApproval">
    <bpmndi:BPMNPlane bpmnElement="collab_InvoiceApproval">
      <bpmndi:BPMNShape id="shape_participant_InvoiceProcessor" bpmnElement="participant_InvoiceProcessor" isHorizontal="true">
        <dc:Bounds x="20" y="20" width="1400" height="350"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_participant_FirstApprover" bpmnElement="participant_FirstApprover" isHorizontal="true">
        <dc:Bounds x="20" y="390" width="1400" height="200"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_participant_SecondApprover" bpmnElement="participant_SecondApprover" isHorizontal="true">
        <dc:Bounds x="20" y="610" width="1400" height="200"/>
      </bpmndi:BPMNShape>

      <!-- Invoice Processor Elements -->
      <bpmndi:BPMNShape id="shape_ip_start_event" bpmnElement="ip_start_event">
        <dc:Bounds x="100" y="177" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_send_1st_approval" bpmnElement="ip_send_1st_approval">
        <dc:Bounds x="200" y="155" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_receive_1st_decision" bpmnElement="ip_receive_1st_decision">
        <dc:Bounds x="450" y="155" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_gateway_1st_decision" bpmnElement="ip_gateway_1st_decision" isMarkerVisible="true">
        <dc:Bounds x="620" y="170" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_end_event_1st_rejection" bpmnElement="ip_end_event_1st_rejection">
        <dc:Bounds x="750" y="100" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_send_2nd_approval" bpmnElement="ip_send_2nd_approval">
        <dc:Bounds x="750" y="205" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_receive_2nd_decision" bpmnElement="ip_receive_2nd_decision">
        <dc:Bounds x="950" y="205" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_gateway_2nd_decision" bpmnElement="ip_gateway_2nd_decision" isMarkerVisible="true">
        <dc:Bounds x="1120" y="220" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_end_event_2nd_rejection" bpmnElement="ip_end_event_2nd_rejection">
        <dc:Bounds x="1250" y="150" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_ip_end_event_approved" bpmnElement="ip_end_event_approved">
        <dc:Bounds x="1250" y="290" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- First Approver Elements -->
      <bpmndi:BPMNShape id="shape_fa_start_message" bpmnElement="fa_start_message">
        <dc:Bounds x="247" y="482" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_fa_task_evaluate" bpmnElement="fa_task_evaluate">
        <dc:Bounds x="350" y="465" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_fa_task_document_submit" bpmnElement="fa_task_document_submit">
        <dc:Bounds x="520" y="465" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_fa_end_message" bpmnElement="fa_end_message">
        <dc:Bounds x="697" y="482" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- Second Approver Elements -->
      <bpmndi:BPMNShape id="shape_sa_start_message" bpmnElement="sa_start_message">
        <dc:Bounds x="797" y="702" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_sa_task_evaluate" bpmnElement="sa_task_evaluate">
        <dc:Bounds x="900" y="685" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_sa_task_document_submit" bpmnElement="sa_task_document_submit">
        <dc:Bounds x="1070" y="685" width="130" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_sa_end_message" bpmnElement="sa_end_message">
        <dc:Bounds x="1247" y="702" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- Invoice Processor Sequence Flows -->
      <bpmndi:BPMNEdge id="edge_flow_ip_1" bpmnElement="flow_ip_1">
        <di:waypoint x="136" y="195"/>
        <di:waypoint x="200" y="195"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_2" bpmnElement="flow_ip_2">
        <di:waypoint x="330" y="195"/>
        <di:waypoint x="450" y="195"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_3" bpmnElement="flow_ip_3">
        <di:waypoint x="580" y="195"/>
        <di:waypoint x="620" y="195"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_4_rejected" bpmnElement="flow_ip_4_rejected">
        <di:waypoint x="645" y="170"/>
        <di:waypoint x="645" y="118"/>
        <di:waypoint x="750" y="118"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_5_approved" bpmnElement="flow_ip_5_approved">
        <di:waypoint x="645" y="220"/>
        <di:waypoint x="645" y="245"/>
        <di:waypoint x="750" y="245"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_6" bpmnElement="flow_ip_6">
        <di:waypoint x="880" y="245"/>
        <di:waypoint x="950" y="245"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_7" bpmnElement="flow_ip_7">
        <di:waypoint x="1080" y="245"/>
        <di:waypoint x="1120" y="245"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_8_rejected" bpmnElement="flow_ip_8_rejected">
        <di:waypoint x="1145" y="220"/>
        <di:waypoint x="1145" y="168"/>
        <di:waypoint x="1250" y="168"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_ip_9_approved" bpmnElement="flow_ip_9_approved">
        <di:waypoint x="1145" y="270"/>
        <di:waypoint x="1145" y="308"/>
        <di:waypoint x="1250" y="308"/>
      </bpmndi:BPMNEdge>

      <!-- First Approver Sequence Flows -->
      <bpmndi:BPMNEdge id="edge_flow_fa_1" bpmnElement="flow_fa_1">
        <di:waypoint x="283" y="500"/>
        <di:waypoint x="350" y="505"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_fa_2" bpmnElement="flow_fa_2">
        <di:waypoint x="480" y="505"/>
        <di:waypoint x="520" y="505"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_fa_3" bpmnElement="flow_fa_3">
        <di:waypoint x="650" y="505"/>
        <di:waypoint x="697" y="500"/>
      </bpmndi:BPMNEdge>

      <!-- Second Approver Sequence Flows -->
      <bpmndi:BPMNEdge id="edge_flow_sa_1" bpmnElement="flow_sa_1">
        <di:waypoint x="833" y="720"/>
        <di:waypoint x="900" y="725"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_sa_2" bpmnElement="flow_sa_2">
        <di:waypoint x="1030" y="725"/>
        <di:waypoint x="1070" y="725"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_sa_3" bpmnElement="flow_sa_3">
        <di:waypoint x="1200" y="725"/>
        <di:waypoint x="1247" y="720"/>
      </bpmndi:BPMNEdge>

      <!-- Message Flows -->
      <bpmndi:BPMNEdge id="edge_mf_ip_to_fa_request" bpmnElement="mf_ip_to_fa_request">
        <di:waypoint x="265" y="235"/> <!-- center of ip_send_1st_approval y + height/2 -->
        <di:waypoint x="265" y="482"/> <!-- center of fa_start_message y -->
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_mf_fa_to_ip_decision" bpmnElement="mf_fa_to_ip_decision">
        <di:waypoint x="715" y="482"/> <!-- center of fa_end_message y -->
        <di:waypoint x="515" y="380"/> <!-- intermediate point -->
        <di:waypoint x="515" y="235"/> <!-- center of ip_receive_1st_decision y + height/2 -->
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_mf_ip_to_sa_request" bpmnElement="mf_ip_to_sa_request">
        <di:waypoint x="815" y="285"/> <!-- center of ip_send_2nd_approval y + height/2 -->
        <di:waypoint x="815" y="702"/> <!-- center of sa_start_message y -->
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_mf_sa_to_ip_decision" bpmnElement="mf_sa_to_ip_decision">
        <di:waypoint x="1265" y="702"/> <!-- center of sa_end_message y -->
        <di:waypoint x="1015" y="600"/> <!-- intermediate point -->
        <di:waypoint x="1015" y="285"/> <!-- center of ip_receive_2nd_decision y + height/2 -->
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</semantic:definitions>
